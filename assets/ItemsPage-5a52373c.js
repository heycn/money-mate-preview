import{j as e,c as $,I as v,u as k,b as t,L as j,F as S,t as b,a as z,i as E,k as F,l as L,r as y,J as I,m as C,n as V,G,T as H,o as P}from"./index-0ab17bf9.js";import{T as U}from"./TimeRangePicker-f3bfd2f8.js";import{i as X,s as O}from"./styled-components.browser.esm-d431dff6.js";import{u as B}from"./useTitle-eae6efdf.js";import{c as J}from"./comfirmable-070a4235.js";import"./Tabs-ee77f8d6.js";const K=()=>e($,{to:"/items/new",replace:!0,children:e("button",{"w-48px":"","h-48px":"",rounded:"50%",fixed:"",flex:"","justify-center":"","items-center":"",bg:"#5eb39e",text:"#f4f4f4","bottom-24px":"","right-24px":"","p-4px":"","b-none":"",children:e(v,{name:"add",className:"w-24px h-24px"})})}),w=({text:s})=>t("p",{"text-center":"","font-300":"",color:"#999",children:["-",e("span",{"px-16px":"",children:s}),"-"]}),W=s=>{const{start:r,end:n}=s,{get:o}=k(),c=(h,x)=>{if(x){const u=(x.pager.page-1)*x.pager.per_page+x.resources.length,g=x.pager.count;if(u>=g)return null}return`/api/v1/items?page=${h+1}&happened_after=${r.removeTime().isoString}&happened_before=${n.removeTime().isoString}`},{data:i,error:a,size:d,setSize:p}=X(c,async h=>(await o(h)).data,{revalidateAll:!0}),f=()=>p(d+1),l=!i&&!a,N=(i==null?void 0:i[d-1])===void 0&&!a,M=l||N;if(i){const h=i[i.length-1],{page:x,per_page:u,count:g}=h.pager,A=(x-1)*u+h.resources.length<g;return t(S,{children:[e("ol",{"px-16px":"",children:i.map(({resources:D})=>D.map(m=>{var T;return t("li",{flex:"","px-4":"","justify-between":"","py-1":"","bg-white":"","rounded-6px":"","mb-8px":"","items-center":"",children:[t("div",{flex:"",children:[e("div",{"text-36px":"","mr-8px":"",children:"😘"}),t("div",{flex:"","flex-col":"","justify-center":"","py-8px":"",children:[e("div",{text:"#333",children:(T=m.tags)==null?void 0:T[0].name}),e("div",{text:"#999","text-12px":"","font-300":"","pt-1":"",children:b(m.happen_at).format("yyyy-MM-dd HH:mm")})]})]}),t("div",{style:{color:m.kind==="expenses"?"#e77975":"##70a3f3"},"text-18px":"","font-500":"",children:[m.kind==="expenses"?"-":"+",m.amount/100]})]},m.id)}))}),t("div",{"px-16px":"","pt-24px":"","pb-64px":"",children:[a&&e(w,{text:"加载失败 请刷新页面"}),A?M?e(j,{}):e("button",{"m-btn":"",onClick:f,children:"加载更多"}):e(w,{text:i[0].pager.count===0?"所选范围 暂无记录":"The End"})]})]})}else return t("div",{children:[a&&e(w,{text:"加载失败 请刷新页面"}),M&&e(j,{})]})},Y=s=>{const{start:r,end:n}=s,{get:o}=k({showLoading:!1,handleError:!1}),{data:c}=z(r&&n&&`/api/v1/items/balance?happened_after=${r.isoString}&happened_before=${n.isoString}`,async p=>(await o(p)).data),{balance:i,expenses:a,income:d}=c??{balance:0,expenses:0,income:0};return t("ol",{"bg-white":"",flex:"","justify-between":"","items-center":"","mx-16px":"","my-24px":"","rounded-10px":"","py-5":"","px-8":"","text-center":"",color:"#999","shadow-lg":"","shadow-light-7":"",children:[t("li",{children:[t("div",{"color-blue":"","font-500":"","text-22px":"",children:[e("span",{"text-12px":"","pr-2px":"","font-mono":"",children:"¥"}),d/100]}),e("div",{children:"收入"})]}),e("span",{"font-300":"",children:"|"}),t("li",{children:[t("div",{"color-red":"","font-500":"","text-22px":"",children:[e("span",{"text-12px":"","pr-2px":"","font-mono":"",children:"¥"}),a/100]}),e("div",{children:"支出"})]}),e("span",{"font-300":"",children:"|"}),t("li",{children:[t("div",{color:"#666","font-500":"","text-22px":"",children:[e("span",{"text-12px":"","pr-2px":"","font-mono":"",children:"¥"}),i/100]}),e("div",{children:"结余"})]})]})},R=O(v)`
  width: 20px; height: 20px; margin-right: 12px;
`,_=O(v)`
  width: 16px; height: 16px; color: #999;
`,q=[{icon:"menu",text:"统计图表",to:"/statistics"},{icon:"menu",text:"导出数据"},{icon:"menu",text:"自定义标签"},{icon:"menu",text:"记账提醒"}],Q=({className:s})=>e("div",{className:s,children:e("ul",{"bg-white":"","text-16px":"","pl-16px":"","pr-8px":"","rounded-8px":"","shadow-xl":"","shadow-light-7":"",children:q.map(({icon:r,text:n,to:o})=>e("li",{"children-flex":"","children-justify-between":"","children-items-center":"","children-py-4":"",children:o?t(E,{to:o,replace:!0,children:[t("span",{flex:"","items-center":"",children:[e(R,{name:r}),n]}),e(_,{name:"right"})]}):t("div",{onClick:()=>window.alert("敬请期待！"),children:[t("span",{flex:"","items-center":"",children:[e(R,{name:r}),n]}),e(_,{name:"right"})]})},n))})}),Z=({className:s})=>{const{get:r}=k({showLoading:!1,handleError:!1}),{data:n,error:o}=z("/api/v1/me",async d=>(await r(d)).data.resource),c=(n==null?void 0:n.name)??(n==null?void 0:n.email),i=F(),a=encodeURIComponent(`${i.pathname}${i.search}`);return o?t($,{to:`/sign_in?from=${a}`,replace:!0,w:"100%",className:s,"mt-24px":"",flex:"","mb-32px":"",children:[e("img",{src:L,"w-48px":"","ml-4px":"","mr-16px":""}),t("div",{flex:"","flex-col":"","justify-between":"",children:[e("h1",{"text-22px":"",text:"#181818","font-500":"","mb-4px":"",children:"MoneyMate"}),e("p",{"text-15px":"",text:"#666","font-300":"",children:"触手可得的记账伴侣"})]})]}):t("div",{block:"",w:"100%",className:s,"mt-24px":"",flex:"","mb-32px":"",children:[e("img",{src:L,"w-48px":"","ml-4px":"","mr-16px":""}),t("div",{flex:"","flex-col":"","justify-between":"",children:[e("h1",{"text-22px":"",text:"#181818","font-500":"","mb-4px":"",title:c,"overflow-hidden":"","text-ellipsis":"",children:c}),e("p",{"text-15px":"",text:"#666","font-300":"",children:"触手可得的记账伴侣"})]})]})},ee=({onClickMask:s,visible:r})=>{const[n,o]=y.useState(r),c=I({opacity:r?1:0,onStart:({value:p})=>p.opacity<.1&&o(!0),onRest:({value:p})=>p.opacity<.1&&o(!1)}),i=I({opacity:r?1:0,transform:r?"translateX(0%)":"translateX(-100%)"}),a={...c,visibility:n?"visible":"hidden"},d=J("确定要退出登录吗？",()=>{window.localStorage.removeItem("jwt"),window.location.reload()});return t(S,{children:[e(C.div,{fixed:"","top-0":"","left-0":"",w:"100%",h:"100%",className:"bg-black:30",style:a,z:"[calc(var(--z-menu)-1)]",onClick:s}),t(C.div,{fixed:"","top-0":"","left-0":"","w-78vw":"","h-screen":"",flex:"","flex-col":"","shadow-2xl":"","shadow-truegray-6":"",style:i,bg:"#f5f5f5","p-16px":"",z:"[calc(var(--z-menu)-1)]",children:[e(Z,{className:"grow-0 shrink-0"}),e(Q,{className:"grow-1 shrink-1"}),e("button",{"m-btn":"","mb-24px":"",onClick:d,children:"退出登录"})]})]})},ae=({title:s})=>{const[r,n]=y.useState({name:"thisMonth",start:b().firstDayOfMonth,end:b().lastDayOfMonth.add(1,"day")}),[o,c]=y.useState(!1),i=l=>{l.start.timestamp>l.end.timestamp&&([l.start,l.end]=[l.end,l.start]),l.end.timestamp-l.start.timestamp>P.DAY*365?c(!0):c(!1),n(l)},{visible:a,setVisible:d}=V(),{start:p,end:f}=r;return B(s),t("div",{"h-screen":"",children:[t(G,{children:[e(H,{title:s,icon:"menu"}),e(U,{currentTimeRange:r,onChange:i})]}),o?e("div",{"text-center":"","p-32px":"",children:"自定义时间跨度不能超过 365 天"}):t(S,{children:[e(Y,{start:p,end:f}),e(W,{start:p,end:f})]}),e(K,{}),e(ee,{visible:a,onClickMask:()=>d(!1)})]})};export{ae as ItemsPage,ae as default};
